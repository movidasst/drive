<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>El drive colaborativo de la movida sst</title>
    
    <!-- SEO y Meta Tags (Búsquedas, WhatsApp, Telegram, etc.) -->
    <meta name="description" content="El drive de La Movida de SST DAO Network">
    <meta name="keywords" content="normas covenin, normas sst venezuela, seguridad y salud en el trabajo, sst dao network, movida sst, drive colaborativo">
    
    <!-- Open Graph (Facebook, WhatsApp, Telegram, LinkedIn) -->
    <meta property="og:title" content="El drive colaborativo de la movida sst">
    <meta property="og:description" content="El drive de La Movida de SST DAO Network">
    <meta property="og:image" content="https://assets.poap.xyz/7a0347ca-c7eb-4842-b5f5-b72c364b1fff.png">
    <meta property="og:url" content="https://www.movidasst.com">
    <meta property="og:type" content="website">
    
    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="El drive colaborativo de la movida sst">
    <meta name="twitter:description" content="El drive de La Movida de SST DAO Network">
    <meta name="twitter:image" content="https://assets.poap.xyz/7a0347ca-c7eb-4842-b5f5-b72c364b1fff.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fuentes Google: Outfit (Incluyendo peso 800) -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            50: '#f8fafc',  /* Fondo Principal */
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            600: '#475569', /* Texto Cuerpo */
                            900: '#0f172a', /* Títulos */
                        },
                        brand: {
                            DEFAULT: '#00b050',
                            dark: '#008f40',
                            light: '#e6f7ed'
                        }
                    },
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'glow': '0 0 15px rgba(0, 176, 80, 0.3)',
                    }
                }
            }
        }
    </script>

    <style>
        /* --- ESTILOS GENERALES --- */
        html, body { 
            width: 100%; min-height: 100vh; margin: 0; padding: 0; 
            font-family: 'Outfit', sans-serif; 
            background-color: #f8fafc; /* Slate 50 */
            color: #475569; /* Slate 600 */
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        /* --- FONDO TECH GRID (SUTIL) --- */
        .tech-bg {
            background-color: #f8fafc;
            background-image: 
                linear-gradient(rgba(148, 163, 184, 0.07) 1px, transparent 1px), 
                linear-gradient(90deg, rgba(148, 163, 184, 0.07) 1px, transparent 1px);
            background-size: 50px 50px;
            position: relative;
        }

        /* Luces Ambientales (Blur Profundo) */
        .ambient-light-top {
            position: fixed; top: -150px; left: 50%; transform: translateX(-50%);
            width: 800px; height: 400px;
            background: radial-gradient(circle, rgba(0, 176, 80, 0.06) 0%, transparent 70%);
            filter: blur(120px); pointer-events: none; z-index: 0;
        }
        .ambient-light-bottom {
            position: fixed; bottom: -150px; right: 0%;
            width: 600px; height: 500px;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.06) 0%, transparent 70%);
            filter: blur(120px); pointer-events: none; z-index: 0;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* --- ANIMACIONES --- */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeInUp 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        
        /* Animación suave para el Visor (Recomendación 2) */
        @keyframes lightboxZoom {
            0% { opacity: 0; transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }
        .lightbox-content-enter { animation: lightboxZoom 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        /* Loader Esqueleto Premium */
        @keyframes shimmer { 0% { background-position: -1000px 0; } 100% { background-position: 1000px 0; } }
        .skeleton-loader div { 
            background: linear-gradient(to right, #f1f5f9 8%, #e2e8f0 18%, #f1f5f9 33%);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite linear; 
        }

        input, select, button { font-size: 16px !important; }
        
        /* Inputs Modernos */
        .input-modern {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            color: #0f172a;
            transition: all 0.3s ease;
        }
        .input-modern:focus {
            border-color: #00b050;
            background-color: #ffffff;
            box-shadow: 0 0 0 4px rgba(0, 176, 80, 0.1);
        }
        .input-modern::placeholder { color: #94a3b8; }

        /* Toast Notification */
        #toast { visibility: hidden; min-width: 280px; background-color: #1e293b; color: #fff; text-align: center; border-radius: 12px; padding: 16px; position: fixed; z-index: 10000; left: 50%; bottom: 30px; transform: translateX(-50%) translateY(20px); font-size: 14px; opacity: 0; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 10px 30px -5px rgba(0,0,0,0.2); font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 8px; }
        #toast.show { visibility: visible; opacity: 1; transform: translateX(-50%) translateY(0); bottom: 50px; }
    </style>
</head>
<body class="tech-bg">

    <!-- Luces Ambientales -->
    <div class="ambient-light-top"></div>
    <div class="ambient-light-bottom"></div>

    <!-- APP PRINCIPAL -->
    <div id="app-container" class="transition-opacity duration-700 relative z-10">
        
        <!-- NAVBAR STICKY GLASSMORPHISM -->
        <header class="sticky top-0 z-50 w-full backdrop-blur-md bg-white/90 border-b border-slate-200 shadow-sm transition-all duration-300">
            <div class="container mx-auto px-4 py-3 max-w-7xl">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <!-- Brand -->
                    <div class="flex items-center gap-4 w-full md:w-auto">
                        <div class="bg-white p-1 rounded-full shadow-md border border-slate-100 flex items-center justify-center">
                            <img src="https://assets.poap.xyz/7a0347ca-c7eb-4842-b5f5-b72c364b1fff.png" class="w-14 h-14 object-contain rounded-full" alt="Logo">
                        </div>
                        <div>
                            <h1 class="text-lg font-extrabold tracking-tight text-slate-900 leading-none">Drive Movida SST</h1>
                            <div class="flex items-center gap-1.5 mt-1">
                                <span class="relative flex h-2 w-2">
                                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                                  <span class="relative inline-flex rounded-full h-2 w-2 bg-brand"></span>
                                </span>
                                <p class="text-[10px] font-bold uppercase tracking-widest text-brand">Online</p>
                            </div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <!-- Recomendación 5: Optimización en móviles usando flex-wrap y orders -->
                    <div class="flex items-center gap-3 w-full md:w-auto justify-between md:justify-end flex-wrap md:flex-nowrap">
                        
                        <!-- BOTÓN DE VOLVER A MOVIDASST -->
                        <a href="https://www.movidasst.com" class="w-auto flex-grow md:flex-grow-0 flex justify-center items-center gap-2 bg-white text-slate-700 border border-slate-200 px-5 py-2.5 rounded-full text-xs font-bold hover:bg-slate-50 hover:text-brand transition-all shadow-sm hover:shadow group">
                            <svg class="w-4 h-4 text-slate-400 group-hover:text-brand transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                            <span class="hidden sm:inline">Volver a la Web</span>
                            <span class="sm:hidden">Volver</span>
                        </a>

                        <!-- BOTÓN DE CANAL WHATSAPP -->
                        <a href="https://whatsapp.com/channel/0029Va0mlH5Jf05mrcCz8r3e" target="_blank" class="w-auto flex-grow md:flex-grow-0 flex justify-center items-center gap-2 bg-[#25D366] text-white px-5 py-2.5 rounded-full text-xs font-bold hover:bg-[#128C7E] transition-all shadow-lg hover:shadow-[#25D366]/30 hover:-translate-y-0.5 group">
                            <svg class="w-4 h-4 text-white/90 group-hover:text-white transition-colors" fill="currentColor" viewBox="0 0 24 24"><path d="M12.031 0C5.385 0 0 5.388 0 12.035c0 2.126.553 4.195 1.603 6.01L.226 23.53l5.63-1.478A11.968 11.968 0 0 0 12.031 24c6.643 0 12.03-5.388 12.03-12.035S18.675 0 12.031 0zm0 21.996c-1.802 0-3.567-.482-5.118-1.4l-.366-.217-3.804.998.995-3.705-.238-.377a9.982 9.982 0 0 1-1.528-5.26c0-5.526 4.498-10.026 10.03-10.026 5.53 0 10.028 4.5 10.028 10.026s-4.5 10.028-10.028 10.026zm5.503-7.525c-.301-.151-1.783-.88-2.06-.98-.276-.101-.478-.151-.678.151-.202.302-.78 1.002-.955 1.203-.176.202-.352.227-.653.076-.302-.151-1.274-.469-2.428-1.503-.898-.806-1.503-1.801-1.68-2.102-.176-.302-.018-.465.132-.616.135-.135.302-.352.453-.528.151-.176.202-.302.302-.503.1-.202.05-.378-.025-.529-.076-.151-.678-1.631-.93-2.234-.246-.588-.495-.508-.678-.518-.176-.008-.378-.008-.579-.008-.201 0-.528.076-.804.378-.276.302-1.056 1.032-1.056 2.518 0 1.486 1.081 2.922 1.232 3.123.151.202 2.133 3.255 5.166 4.56.721.311 1.283.497 1.722.636.724.23 1.383.197 1.898.119.58-.088 1.783-.728 2.034-1.433.251-.705.251-1.309.176-1.434-.076-.126-.277-.202-.579-.353z"/></svg>
                            <span class="hidden sm:inline">Canal WhatsApp</span>
                            <span class="sm:hidden">Canal</span>
                        </a>

                        <!-- BOTÓN DE APORTE -->
                        <a href="https://forms.gle/haUg2ZRDqCeqMSJVA" target="_blank" class="w-auto flex-grow md:flex-grow-0 flex justify-center items-center gap-2 bg-slate-900 text-white px-5 py-2.5 rounded-full text-xs font-bold hover:bg-brand transition-all shadow-lg hover:shadow-brand/30 hover:-translate-y-0.5 group">
                            <svg class="w-4 h-4 text-slate-300 group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                            <span class="hidden sm:inline">Aportar Recurso</span>
                            <span class="sm:hidden">Aportar</span>
                        </a>

                        <div class="hidden lg:flex flex-col items-end mr-2">
                            <span class="text-xs font-semibold text-slate-900">Hola, <span class="text-brand">Equipo</span></span>
                        </div>
                        
                        <div class="flex gap-1 bg-slate-100 p-1 rounded-lg">
                             <button id="grid-view-btn" class="p-1.5 rounded-md bg-white text-brand shadow-sm transition-all"><svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h6v6H4zm10 0h6v6h-6zM4 14h6v6H4zm10 0h6v6h-6z"/></svg></button>
                             <button id="list-view-btn" class="p-1.5 rounded-md text-slate-400 hover:text-slate-600 transition-all"><svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/></svg></button>
                        </div>

                        <!-- Search Bar Integrada -->
                        <div class="relative group w-full md:w-64 order-last md:order-none mt-2 md:mt-0" title="La búsqueda aplica solo a los archivos de la carpeta actual">
                            <input type="text" id="search-input" placeholder="Buscar en esta carpeta..." class="w-full pl-10 pr-10 py-2.5 bg-slate-100 border-none rounded-full text-sm font-medium text-slate-700 focus:bg-white focus:ring-2 focus:ring-brand/20 transition-all placeholder-slate-400 shadow-inner">
                            <svg class="w-4 h-4 text-slate-400 group-hover:text-brand transition-colors absolute left-3.5 top-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                            
                            <!-- Botón Limpiar Búsqueda ("X") -->
                            <button id="clear-search-btn" class="hidden absolute right-3 top-3 text-slate-400 hover:text-slate-600 transition-colors bg-slate-200 hover:bg-slate-300 rounded-full p-0.5" title="Limpiar búsqueda">
                                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Breadcrumbs Row -->
                <div class="mt-3 pt-2 border-t border-slate-100 flex items-center gap-2 overflow-x-auto pb-1 no-scrollbar" id="breadcrumb-container">
                    <!-- JS Injected -->
                </div>
            </div>
        </header>

        <div class="container mx-auto p-4 sm:p-6 pb-24 max-w-7xl">
            <!-- Area de Contenido -->
            <div id="content" class="min-h-[400px]">
                 <!-- Loader Skeleton -->
                 <div id="skeleton-loader" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                    <script>
                        for(let i=0; i<10; i++) {
                            document.write(`
                            <div class="bg-white rounded-2xl p-5 border border-slate-100 shadow-sm flex flex-col items-center">
                                <div class="w-full aspect-square bg-slate-50 rounded-xl mb-4 animate-pulse"></div>
                                <div class="w-3/4 h-3 bg-slate-100 rounded-full animate-pulse mb-2"></div>
                                <div class="w-1/2 h-2 bg-slate-50 rounded-full animate-pulse"></div>
                            </div>`);
                        }
                    </script>
                 </div>
                
                <!-- Mensajes de Estado -->
                <div id="error-container" class="hidden flex flex-col items-center justify-center py-20">
                    <div class="bg-red-50 text-red-500 rounded-full p-4 mb-4 ring-8 ring-red-50/50"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg></div>
                    <p class="text-slate-800 font-bold mb-1">Algo salió mal</p>
                    <p class="text-slate-500 text-sm mb-4" id="error-text">No pudimos cargar los archivos</p>
                    <button onclick="location.reload()" class="px-5 py-2 bg-slate-900 text-white rounded-lg text-sm font-medium hover:bg-black transition-colors">Intentar de nuevo</button>
                </div>
                
                <div id="no-results" class="hidden flex flex-col items-center justify-center py-24 text-slate-400">
                    <div class="bg-slate-50 p-6 rounded-3xl mb-4 border border-slate-100 shadow-sm">
                        <svg class="w-12 h-12 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path></svg>
                    </div>
                    <p class="text-slate-500 font-medium">No se encontraron resultados</p>
                </div>

                <!-- Grid de Archivos -->
                <!-- Ajustado items-start para que las carpetas compactas no se estiren verticalmente -->
                <div id="file-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 items-start"></div>
                
                <!-- Load More -->
                <div id="load-more-container" class="flex justify-center mt-16 pb-12"></div>
            </div>
        </div>
    </div>

    <!-- Lightbox de Vista Previa (Modo Cine) -->
    <div id="lightbox-overlay" class="fixed inset-0 bg-slate-900/95 z-[10000] hidden flex flex-col transition-opacity duration-300 backdrop-blur-sm">
        <div class="flex justify-between items-center px-6 py-4 bg-gradient-to-b from-black/50 to-transparent text-white absolute top-0 w-full z-20 pointer-events-none">
            <div class="pointer-events-auto flex items-center gap-3">
                <div class="p-2 bg-white/10 rounded-lg backdrop-blur-md border border-white/10">
                    <svg class="w-5 h-5 text-brand" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                </div>
                <h3 id="lightbox-title" class="text-sm font-semibold tracking-wide text-shadow">Vista Previa</h3>
            </div>
            
            <button onclick="closeLightbox()" class="pointer-events-auto p-2.5 bg-white/5 hover:bg-white/15 rounded-full transition-all border border-white/5 hover:border-white/20 group">
                <svg class="w-5 h-5 text-slate-400 group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        
        <div id="lightbox-body" class="flex-grow flex items-center justify-center w-full h-full p-6 overflow-hidden relative">
            <!-- Loader inicial del visor -->
            <div id="preview-loader" class="flex flex-col items-center gap-4">
                <div class="relative w-16 h-16">
                    <div class="absolute inset-0 border-4 border-slate-700 rounded-full"></div>
                    <div class="absolute inset-0 border-4 border-t-brand rounded-full animate-spin"></div>
                </div>
            </div>
        </div>
        
        <!-- Botón Externo de Seguridad -->
        <div class="absolute bottom-10 left-0 w-full flex justify-center z-20 pointer-events-none">
             <a id="lightbox-external-link" href="#" target="_blank" class="pointer-events-auto bg-white hover:bg-slate-50 text-slate-900 text-xs font-bold py-3 px-6 rounded-full shadow-lg hover:shadow-xl hover:scale-105 transition-all flex items-center gap-2 border border-slate-100">
                <svg class="w-4 h-4 text-brand" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                ABRIR EN NUEVA PESTAÑA
             </a>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast">
        <svg class="w-5 h-5 text-brand" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
        <span>Enlace copiado al portapapeles</span>
    </div>

    <script>
        /* --- CONFIGURACIÓN --- */
        const CONFIG = {
            API_KEY: 'AIzaSyCclnDEY_Rsq33mNiGmcAuqECD5Tv4Uk5I',
            ROOT_FOLDER: '1wnDWCTeL8fMGmo7_hOim6rT1d_omAbcq'
        };
        
        let state = { files: [], stack: [{ id: CONFIG.ROOT_FOLDER, name: 'Inicio' }], token: null, view: 'grid' };

        const $ = id => document.getElementById(id);
        const escapeHtml = (unsafe) => unsafe.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
        
        function showToast(message) {
            const x = $("toast");
            x.querySelector('span').textContent = message;
            x.className = "show";
            setTimeout(() => { x.className = x.className.replace("show", ""); }, 3000);
        }

        /* --- DRIVE LOGIC --- */
        async function initDrive() {
            if (!window.gapi) await loadScript('https://apis.google.com/js/api.js');
            gapi.load('client', async () => {
                try {
                    await gapi.client.init({ apiKey: CONFIG.API_KEY, discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'] });
                    loadFolder(CONFIG.ROOT_FOLDER);
                } catch(e) { showError("Error API: " + (e.error?.message || e.message)); }
            });
        }

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const s = document.createElement('script'); s.src = src; s.onload = resolve; s.onerror = reject; document.body.appendChild(s);
            });
        }

        window.navTo = function(id, name, push = false) {
            if (push) {
                if(state.stack[state.stack.length-1].id !== id) state.stack.push({ id, name: decodeURIComponent(name) });
            } else {
                const idx = state.stack.findIndex(x => x.id === id);
                if (idx !== -1) state.stack = state.stack.slice(0, idx + 1);
            }
            $('search-input').value = ''; // Limpiar búsqueda al cambiar de carpeta
            $('clear-search-btn').classList.add('hidden');
            renderBreadcrumbs(); 
            loadFolder(id);
        }

        async function loadFolder(folderId, pageToken = null) {
            const container = $('file-container'), loader = $('skeleton-loader'), loadMore = $('load-more-container'), noRes = $('no-results');
            
            if (!pageToken) { container.innerHTML = ''; state.files = []; loader.classList.remove('hidden'); noRes.classList.add('hidden'); $('error-container').classList.add('hidden'); loadMore.innerHTML = ''; }

            try {
                const res = await gapi.client.drive.files.list({
                    pageSize: 100, fields: 'nextPageToken, files(id, name, mimeType, webViewLink, iconLink, modifiedTime, thumbnailLink, size)',
                    q: `'${folderId}' in parents and trashed = false`, orderBy: 'folder,name', pageToken: pageToken,
                    includeItemsFromAllDrives: true, supportsAllDrives: true
                });

                loader.classList.add('hidden');
                state.files = [...state.files, ...(res.result.files || [])];
                state.token = res.result.nextPageToken;

                renderFiles(res.result.files || [], !pageToken);
                if (state.files.length === 0) noRes.classList.remove('hidden');
                
                if (state.token) {
                    const btn = document.createElement('button');
                    btn.className = 'text-brand text-xs font-extrabold border-2 border-brand px-10 py-3 rounded-full hover:bg-brand hover:text-white transition-all duration-300 uppercase tracking-widest shadow-lg hover:shadow-brand/40 transform hover:-translate-y-1';
                    btn.textContent = 'Cargar más archivos'; btn.onclick = () => loadFolder(folderId, state.token);
                    loadMore.innerHTML = ''; loadMore.appendChild(btn);
                }
            } catch (e) { loader.classList.add('hidden'); showError("No se pudo conectar con Drive."); }
        }

        function showError(msg) { $('error-text').textContent = msg; $('error-container').classList.remove('hidden'); }

        /* --- RENDER LOGIC --- */
        function getFileIcon(mime, originalIcon) {
            // Mapeo de colores por tipo
            if(mime.includes('folder')) return { icon: `<svg class="w-10 h-10 text-yellow-400 drop-shadow-sm" fill="currentColor" viewBox="0 0 20 20"><path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"></path></svg>`, bg: 'bg-yellow-50', shadow: 'hover:shadow-yellow-500/20' };
            if(mime.includes('pdf')) return { icon: `<svg class="w-10 h-10 text-red-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"></path></svg>`, bg: 'bg-red-50', shadow: 'hover:shadow-red-500/20' };
            if(mime.includes('sheet') || mime.includes('excel')) return { icon: `<svg class="w-10 h-10 text-emerald-600" fill="currentColor" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>`, bg: 'bg-emerald-50', shadow: 'hover:shadow-emerald-500/20' };
            if(mime.includes('word') || mime.includes('document')) return { icon: `<svg class="w-10 h-10 text-blue-600" fill="currentColor" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>`, bg: 'bg-blue-50', shadow: 'hover:shadow-blue-500/20' };
            if(mime.includes('image')) return { icon: `<svg class="w-10 h-10 text-purple-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"></path></svg>`, bg: 'bg-purple-50', shadow: 'hover:shadow-purple-500/20' };
            
            // Default
            return { icon: `<img src="${originalIcon}" class="w-8 h-8 opacity-50 grayscale">`, bg: 'bg-slate-50', shadow: 'hover:shadow-slate-400/20' };
        }

        function renderFiles(files, append = false) {
            const container = $('file-container'), term = $('search-input').value.toLowerCase();
            const filtered = files.filter(f => f.name.toLowerCase().includes(term));
            if(!append) container.innerHTML = '';
            
            // Recomendación 1: Acciones amigables para Celular (opacity-100 en móviles, hover en PC)
            const mobileFriendlyActions = "opacity-100 md:opacity-0 group-hover:opacity-100 transition-opacity";

            filtered.forEach((f, i) => {
                const isFolder = f.mimeType.includes('folder'), isImg = f.mimeType.includes('image'), isPdf = f.mimeType.includes('pdf');
                const canPreview = isImg || isPdf;
                const safeName = escapeHtml(f.name), safeLink = encodeURIComponent(f.name);
                const date = new Date(f.modifiedTime).toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' });
                
                let action = isFolder ? `navTo('${f.id}', '${safeLink}', true)` : (canPreview ? `previewFile('${safeLink}', '${f.mimeType}', '${f.webViewLink}', '${f.thumbnailLink}')` : `window.open('${f.webViewLink}', '_blank')`);

                const fileInfo = getFileIcon(f.mimeType, f.iconLink);
                const el = document.createElement('div');
                el.style.animationDelay = `${Math.min(i * 40, 400)}ms`;
                
                if(state.view === 'grid') {
                    // Recomendación 3: Carpetas compactas vs Archivos grandes en la Cuadrícula
                    if(isFolder) {
                        el.className = `fade-in bg-white col-span-1 rounded-xl p-3 border border-slate-100 shadow-sm hover:shadow-md ${fileInfo.shadow} transition-all duration-300 transform hover:-translate-y-1 flex items-center gap-3 cursor-pointer group`;
                        el.innerHTML = `
                            <div class="flex-shrink-0 w-10 h-10 flex items-center justify-center ${fileInfo.bg} rounded-lg shadow-inner">
                                 ${fileInfo.icon.replace('w-10 h-10', 'w-5 h-5')}
                            </div>
                            <div class="flex-grow min-w-0" onclick="${action}">
                                <h3 class="text-sm font-bold text-slate-800 line-clamp-3 leading-snug group-hover:text-brand transition-colors" title="${safeName}">${safeName}</h3>
                                <p class="text-[10px] text-slate-400 mt-1">${date}</p>
                            </div>
                        `;
                    } else {
                        let thumb = isImg && f.thumbnailLink ? 
                            `<div class="w-full aspect-square rounded-xl bg-slate-50 mb-4 overflow-hidden relative shadow-inner"><img src="${f.thumbnailLink.replace('=s220', '=s400')}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" loading="lazy"></div>` : 
                            `<div class="w-full aspect-square rounded-xl ${fileInfo.bg} mb-4 flex items-center justify-center transition-colors shadow-inner">${fileInfo.icon}</div>`;

                        el.className = `fade-in bg-white rounded-2xl p-5 border border-slate-100 shadow-sm hover:shadow-xl ${fileInfo.shadow} transition-all duration-300 transform hover:-translate-y-2 flex flex-col justify-between group h-full`;
                        el.innerHTML = `
                            <div onclick="${action}" class="cursor-pointer">
                                ${thumb}
                                <h3 class="text-sm font-bold text-slate-800 leading-snug line-clamp-2 mb-2 group-hover:text-brand transition-colors" title="${safeName}">${safeName}</h3>
                                <p class="text-[11px] text-slate-400 font-medium flex items-center gap-1.5">
                                    ${date}
                                </p>
                            </div>
                            <div class="mt-4 pt-3 border-t border-slate-50 flex justify-between items-center ${mobileFriendlyActions}">
                                <button onclick="shareLink('${f.webViewLink}')" class="text-slate-400 hover:text-brand transition-colors p-1 bg-slate-50 rounded-lg md:bg-transparent" title="Compartir"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg></button>
                                <button onclick="copyLink('${f.webViewLink}')" class="text-slate-400 hover:text-blue-500 transition-colors p-1 bg-slate-50 rounded-lg md:bg-transparent" title="Copiar Link"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg></button>
                            </div>`;
                    }
                } else {
                    // List View
                    el.className = `fade-in bg-white rounded-xl p-4 border border-slate-100 shadow-sm hover:shadow-lg ${fileInfo.shadow} transition-all duration-300 flex items-center gap-4 cursor-pointer mb-3 group transform hover:-translate-x-1`;
                    el.innerHTML = `
                        <div onclick="${action}" class="flex-shrink-0 w-12 h-12 flex items-center justify-center ${fileInfo.bg} rounded-xl shadow-sm">
                             ${isImg ? `<img src="${f.thumbnailLink}" class="w-full h-full object-cover rounded-xl">` : fileInfo.icon.replace('w-10 h-10', 'w-6 h-6')}
                        </div>
                        <div onclick="${action}" class="flex-grow min-w-0">
                            <h3 class="text-sm font-bold text-slate-800 line-clamp-2 leading-snug group-hover:text-brand transition-colors" title="${safeName}">${safeName}</h3>
                            <p class="text-xs text-slate-400 mt-0.5">${date}</p>
                        </div>
                        ${!isFolder ? `<div class="flex gap-2 ${mobileFriendlyActions}">
                            <button onclick="shareLink('${f.webViewLink}')" class="p-2 text-slate-400 hover:text-brand bg-slate-50 hover:bg-brand/10 rounded-lg transition-colors"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg></button>
                            <button onclick="copyLink('${f.webViewLink}')" class="p-2 text-slate-400 hover:text-blue-500 bg-slate-50 hover:bg-blue-50 rounded-lg transition-colors"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg></button>
                        </div>` : ''}`;
                }
                container.appendChild(el);
            });
        }

        function renderBreadcrumbs() {
            const c = $('breadcrumb-container'); c.innerHTML = '';
            state.stack.forEach((folder, i) => {
                const isLast = i === state.stack.length - 1;
                const span = document.createElement('span'); span.className = 'flex items-center flex-shrink-0';
                if (isLast) span.innerHTML = `<span class="font-bold text-slate-900 truncate max-w-[200px] bg-white px-3 py-1.5 rounded-lg border border-slate-200 shadow-sm text-xs uppercase tracking-wide">${escapeHtml(folder.name)}</span>`;
                else span.innerHTML = `<button onclick="navTo('${folder.id}','',false)" class="text-slate-500 hover:text-brand hover:bg-white px-2 py-1.5 rounded-lg transition-all font-semibold text-xs uppercase tracking-wide flex items-center gap-1">${escapeHtml(folder.name)}</button><svg class="w-3 h-3 text-slate-300 mx-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>`;
                c.appendChild(span);
            });
        }

        /* --- PREVIEW & ACTIONS --- */
        window.previewFile = function(encName, mime, link, thumbLink) {
            const name = decodeURIComponent(encName), overlay = $('lightbox-overlay'), body = $('lightbox-body'), title = $('lightbox-title'), extLink = $('lightbox-external-link');
            body.innerHTML = ''; 
            overlay.classList.remove('hidden');
            
            // Recomendación 2: Contenedor con animación de Zoom-In
            const animatedWrapper = document.createElement('div');
            animatedWrapper.className = 'w-full h-full flex items-center justify-center lightbox-content-enter';
            
            extLink.href = link; 
            
            if (mime.includes('image')) {
                const img = new Image(); img.className = 'max-w-full max-h-full object-contain rounded-lg shadow-2xl';
                img.onload = () => { animatedWrapper.appendChild(img); body.appendChild(animatedWrapper); };
                img.src = thumbLink ? thumbLink.replace(/=s\d+/, '=s1600') : link; 
            } else {
                const iframe = document.createElement('iframe');
                iframe.src = link.replace(/\/view.*/, '/preview');
                iframe.className = 'w-full h-full md:w-[90%] md:h-[85%] bg-white rounded-xl shadow-2xl border-0';
                animatedWrapper.appendChild(iframe);
                body.appendChild(animatedWrapper);
            }
        }

        window.closeLightbox = () => $('lightbox-overlay').classList.add('hidden');
        document.addEventListener('keydown', (e) => { if(e.key === 'Escape') closeLightbox(); });

        window.shareLink = (link) => window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent('Te comparto este archivo de la Movida SST: ' + link)}`, '_blank');

        window.copyLink = (text) => {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed"; textArea.style.left = "-9999px";
            document.body.appendChild(textArea); textArea.focus(); textArea.select();
            try { document.execCommand('copy'); showToast("Enlace copiado al portapapeles"); } 
            catch (err) { showToast("No se pudo copiar el enlace"); }
            document.body.removeChild(textArea);
        }

        /* --- EVENTOS --- */
        
        // Recomendación 4: Limpiar búsqueda interactiva
        const searchInput = $('search-input');
        const clearBtn = $('clear-search-btn');

        searchInput.addEventListener('input', () => {
            if(searchInput.value.length > 0) clearBtn.classList.remove('hidden');
            else clearBtn.classList.add('hidden');
            
            renderFiles(state.files);
            if(state.files.length > 0 && $('file-container').children.length === 0) $('file-container').innerHTML = '<div class="col-span-full text-center py-20"><p class="text-slate-400 font-medium">No encontramos resultados en esta carpeta</p></div>';
        });

        clearBtn.addEventListener('click', () => {
            searchInput.value = '';
            clearBtn.classList.add('hidden');
            renderFiles(state.files);
        });

        $('grid-view-btn').addEventListener('click', () => { 
            state.view = 'grid'; 
            $('file-container').className = 'grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 items-start';
            $('grid-view-btn').className = "p-1.5 rounded-md bg-white text-brand shadow-sm transition-all";
            $('list-view-btn').className = "p-1.5 rounded-md text-slate-400 hover:text-slate-600 transition-all";
            renderFiles(state.files); 
        });

        $('list-view-btn').addEventListener('click', () => { 
            state.view = 'list'; 
            $('file-container').className = 'flex flex-col gap-2';
            $('list-view-btn').className = "p-1.5 rounded-md bg-white text-brand shadow-sm transition-all";
            $('grid-view-btn').className = "p-1.5 rounded-md text-slate-400 hover:text-slate-600 transition-all";
            renderFiles(state.files); 
        });

        // Inicializar el Drive directamente al cargar
        initDrive();
    </script>
</body>
</html>
